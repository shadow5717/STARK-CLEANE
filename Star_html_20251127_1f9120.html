<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>STARK CLEANE - Sistema de Gestión</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --primary-light: #64b5f6;
            --secondary: #ff6d00;
            --secondary-dark: #e65100;
            --accent: #00c853;
            --danger: #d32f2f;
            --warning: #ffa000;
            --info: #0288d1;
            --dark: #121212;
            --light: #f5f7fb;
            --gray: #5f6368;
            --gray-light: #e8eaed;
            --sidebar-width: 260px;
            --header-height: 70px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
                0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --text-secondary: #9e9e9e;
            --border-color: #333;
            --hover-color: #2a2a2a;
        }

        .light-mode {
            --bg-color: #f5f7fb;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-secondary: #5f6368;
            --border-color: #e0e0e0;
            --hover-color: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            overflow-x: hidden;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Login Styles */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .login-box {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .login-logo {
            margin-bottom: 30px;
        }

        .logo-img {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .login-title {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: var(--text-color);
        }

        .login-form .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }

        .login-form input {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            font-size: 0.95rem;
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .login-btn:hover {
            background: var(--primary-dark);
        }

        .register-btn {
            width: 100%;
            padding: 14px;
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .register-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(
                180deg,
                var(--primary) 0%,
                var(--primary-dark) 100%
            );
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .sidebar-header {
            padding: 25px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: bold;
            font-size: 1.4rem;
            color: white;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: bold;
            font-size: 1.2rem;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 14px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 500;
        }

        .menu-item:hover,
        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            border-left: 4px solid white;
            color: white;
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .submenu.active {
            max-height: 300px;
        }

        .submenu-item {
            padding: 12px 20px 12px 60px;
            cursor: pointer;
            transition: var(--transition);
            color: rgba(255, 255, 255, 0.75);
            font-size: 0.9rem;
        }

        .submenu-item:hover {
            background-color: rgba(255, 255, 255, 0.08);
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
        }

        .header {
            height: var(--header-height);
            background: var(--card-bg);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--text-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background-color: var(--hover-color);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 20px;
            transition: var(--transition);
        }

        .user-profile:hover {
            background-color: var(--hover-color);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Content Area */
        .content {
            padding: 25px;
        }

        .page-title {
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .page-title h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Dashboard Styles */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 25px;
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .card-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .barberia {
            background: rgba(26, 115, 232, 0.15);
            color: var(--primary);
        }
        .billar {
            background: rgba(255, 109, 0, 0.15);
            color: var(--secondary);
        }
        .carwash {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }
        .config {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .card h3 {
            font-size: 1.3rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .card p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .trend-up {
            color: var(--accent);
        }
        .trend-down {
            color: var(--danger);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .stat-card h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .chart-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 25px;
            border: 1px solid var(--border-color);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        /* Page Styles */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page.active {
            display: block;
        }

        /* Table Styles */
        .table-container {
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 18px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--hover-color);
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        tr:hover {
            background-color: var(--hover-color);
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .badge-success {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }

        .badge-warning {
            background: rgba(255, 160, 0, 0.15);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(2, 136, 209, 0.15);
            color: var(--info);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-success {
            background: var(--accent);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.85rem;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Form Styles */
        .form-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-color);
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
            font-size: 0.95rem;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
        }

        /* POS Styles */
        .pos-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 18px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
        }

        .product-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .product-image {
            width: 80px;
            height: 80px;
            background: var(--hover-color);
            border-radius: 10px;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: var(--primary);
        }

        .product-card h4 {
            font-size: 1rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .product-card p {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--secondary);
        }

        .cart {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            height: fit-content;
            border: 1px solid var(--border-color);
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .cart-title {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .cart-item-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .cart-item-name {
            font-weight: 500;
        }

        .cart-item-price {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--hover-color);
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: var(--text-color);
        }

        .cart-total {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 20px 0;
            text-align: right;
            color: var(--secondary);
        }

        /* Vehicle Cards */
        .vehicles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .vehicle-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border-left: 5px solid var(--primary);
            border: 1px solid var(--border-color);
        }

        .vehicle-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .vehicle-placa {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .vehicle-type {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .car {
            background: rgba(26, 115, 232, 0.15);
            color: var(--primary);
        }
        .jeepeta {
            background: rgba(255, 109, 0, 0.15);
            color: var(--secondary);
        }
        .motor {
            background: rgba(0, 200, 83, 0.15);
            color: var(--accent);
        }
        .camion {
            background: rgba(211, 47, 47, 0.15);
            color: var(--danger);
        }

        .vehicle-details {
            margin-bottom: 20px;
        }

        .vehicle-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .vehicle-time {
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .tab {
            padding: 14px 24px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            font-weight: 500;
            white-space: nowrap;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Stock Alert Styles */
        .alert-container {
            position: fixed;
            top: 100px;
            right: 25px;
            z-index: 10000;
            max-width: 400px;
        }

        .stock-alert {
            background: var(--card-bg);
            border-left: 4px solid var(--warning);
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.3s ease;
        }

        .alert-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-icon {
            color: var(--warning);
            font-size: 1.2rem;
        }

        .alert-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .alert-close:hover {
            color: var(--danger);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Print Styles */
        @media print {
            .sidebar,
            .header,
            .btn,
            .alert-container,
            .notification {
                display: none !important;
            }
            .main-content {
                margin-left: 0 !important;
            }
            .receipt {
                width: 100% !important;
                max-width: 100% !important;
                box-shadow: none !important;
                border: none !important;
            }
        }

        .receipt {
            background: white;
            color: black;
            padding: 20px;
            width: 300px;
            max-width: 100%;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 1px dashed #333;
            padding-bottom: 10px;
        }

        .receipt-logo {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .receipt-details {
            margin-bottom: 15px;
        }

        .receipt-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        .receipt-table th,
        .receipt-table td {
            padding: 4px 0;
            border-bottom: 1px dashed #ccc;
        }

        .receipt-table th {
            text-align: left;
        }

        .receipt-table td:last-child {
            text-align: right;
        }

        .receipt-total {
            text-align: right;
            font-weight: bold;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #333;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .hamburger {
                display: block;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .pos-container {
                grid-template-columns: 1fr;
            }
            .user-info {
                display: none;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 100px;
            right: 25px;
            background: var(--card-bg);
            color: var(--text-color);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--accent);
            z-index: 10000;
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s;
            max-width: 350px;
        }
        .notification.error {
            border-left: 4px solid var(--danger);
        }
        .notification.warning {
            border-left: 4px solid var(--warning);
        }
        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .notification i {
            font-size: 1.2rem;
        }
        .notification.success i {
            color: var(--accent);
        }
        .notification.error i {
            color: var(--danger);
        }
        .notification.warning i {
            color: var(--warning);
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body class="dark-mode">
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <div class="login-logo">
                <div class="logo-img">STARK CLEANE</div>
            </div>
            <h2 class="login-title">Iniciar Sesión</h2>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">Usuario</label>
                    <input type="text" id="username" placeholder="Ingrese su usuario" required>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <input type="password" id="password" placeholder="Ingrese su contraseña" required>
                </div>
                <button type="submit" class="login-btn">Iniciar Sesión</button>
            </form>
            <button class="register-btn" id="showRegisterBtn">Registrar Usuario</button>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Registrar Nuevo Usuario</div>
                <button class="modal-close" id="closeRegisterModal">&times;</button>
            </div>
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="register-username">Usuario</label>
                        <input type="text" id="register-username" placeholder="Ingrese un nombre de usuario">
                    </div>
                    <div class="form-group">
                        <label for="register-password">Contraseña</label>
                        <input type="password" id="register-password" placeholder="Ingrese una contraseña">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="register-nombre">Nombre Completo</label>
                        <input type="text" id="register-nombre" placeholder="Ingrese su nombre completo">
                    </div>
                    <div class="form-group">
                        <label for="register-rol">Rol</label>
                        <select id="register-rol">
                            <option value="admin">Administrador</option>
                            <option value="vendedor">Vendedor</option>
                            <option value="empleado">Empleado</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" id="registerBtn">
                    <i class="fas fa-save"></i> Registrar Usuario
                </button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="container" id="appContainer" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">SC</div>
                    <span>STARK CLEANE</span>
                </div>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </div>

                <div class="menu-item" data-page="barberia">
                    <i class="fas fa-cut"></i>
                    <span>Barbería</span>
                </div>

                <div class="menu-item" data-page="billar">
                    <i class="fas fa-dice"></i>
                    <span>Billar</span>
                </div>

                <div class="menu-item" data-page="carwash">
                    <i class="fas fa-car"></i>
                    <span>Car Wash</span>
                </div>

                <div class="menu-item" data-submenu="configuracion">
                    <i class="fas fa-cog"></i>
                    <span>Configuración</span>
                    <i class="fas fa-chevron-down ml-auto"></i>
                </div>
                <div class="submenu" id="configuracion-submenu">
                    <div class="submenu-item" data-page="config-usuarios">Usuarios</div>
                    <div class="submenu-item" data-page="config-impresora">Impresora</div>
                    <div class="submenu-item" data-page="config-preferencias">Preferencias</div>
                    <div class="submenu-item" data-page="config-tema">Tema</div>
                </div>

                <div class="menu-item" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Cerrar Sesión</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <div class="hamburger">
                        <i class="fas fa-bars"></i>
                    </div>
                    <div class="header-title" id="headerTitle">Dashboard</div>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">A</div>
                        <div class="user-info">
                            <div class="user-name" id="userName">Administrador</div>
                            <div class="user-role" id="userRole">Super Admin</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content">
                <!-- Dashboard -->
                <div class="page active" id="dashboard">
                    <div class="page-title">
                        <h1>Dashboard Principal</h1>
                        <div class="header-actions">
                            <button class="btn btn-outline" id="refreshDashboard">
                                <i class="fas fa-sync-alt"></i> Actualizar
                            </button>
                        </div>
                    </div>

                    <div class="dashboard-cards">
                        <div class="card" data-page="barberia">
                            <div class="card-icon barberia">
                                <i class="fas fa-cut"></i>
                            </div>
                            <h3>Barbería</h3>
                            <p>Gestión de citas y clientes</p>
                            <div class="card-value" id="appointmentsCount">0</div>
                            <div class="card-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="appointmentsTrend">0 citas hoy</span>
                            </div>
                        </div>

                        <div class="card" data-page="billar">
                            <div class="card-icon billar">
                                <i class="fas fa-dice"></i>
                            </div>
                            <h3>Billar</h3>
                            <p>Punto de venta e inventario</p>
                            <div class="card-value" id="salesTotal">RD$ 0</div>
                            <div class="card-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="salesTrend">0% más que ayer</span>
                            </div>
                        </div>

                        <div class="card" data-page="carwash">
                            <div class="card-icon carwash">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3>Car Wash</h3>
                            <p>Lavado de vehículos</p>
                            <div class="card-value" id="vehiclesCount">0</div>
                            <div class="card-trend trend-down">
                                <i class="fas fa-arrow-down"></i>
                                <span id="vehiclesTrend">0 menos que ayer</span>
                            </div>
                        </div>

                        <div class="card" data-page="config-tema">
                            <div class="card-icon config">
                                <i class="fas fa-cog"></i>
                            </div>
                            <h3>Configuración</h3>
                            <p>Personaliza tu sistema</p>
                            <div class="card-value">4</div>
                            <div class="card-trend">
                                <span>Opciones disponibles</span>
                            </div>
                        </div>
                    </div>

                    <div class="stats">
                        <div class="stat-card">
                            <h3>Ingresos de Hoy</h3>
                            <div class="stat-value" id="dailyIncome">RD$ 0</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="incomeTrend">0% más que ayer</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <h3>Clientes Atendidos</h3>
                            <div class="stat-value" id="customersCount">0</div>
                            <div class="stat-trend trend-up">
                                <i class="fas fa-arrow-up"></i>
                                <span id="customersTrend">0% más que ayer</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <h3>Productos Vendidos</h3>
                            <div class="stat-value" id="productsSold">0</div>
                            <div class="stat-trend trend-down">
                                <i class="fas fa-arrow-down"></i>
                                <span id="productsTrend">0% menos que ayer</span>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-title">Ventas de la Semana</div>
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>

                <!-- Barbería - Página Completa -->
                <div class="page" id="barberia">
                    <div class="page-title">
                        <h1>Barbería</h1>
                        <button class="btn btn-primary" id="newAppointmentBtn">
                            <i class="fas fa-plus"></i> Nueva Cita
                        </button>
                    </div>

                    <!-- Tabs de Barbería -->
                    <div class="tabs">
                        <div class="tab active" data-tab="barberia-citas">Registrar Cliente</div>
                        <div class="tab" data-tab="barberia-lista">Lista de Citas</div>
                        <div class="tab" data-tab="barberia-historial">Historial</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="barberia-citas">
                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="nombre"><i class="fas fa-user"></i> Nombre</label>
                                    <input type="text" id="nombre" placeholder="Ingrese el nombre completo" />
                                </div>
                                <div class="form-group">
                                    <label for="telefono"><i class="fas fa-phone"></i> Teléfono</label>
                                    <input type="text" id="telefono" placeholder="Ingrese el teléfono" />
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="barbero"><i class="fas fa-user-tie"></i> Barbero</label>
                                    <select id="barbero">
                                        <option value="Anthony">Anthony</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="servicio"><i class="fas fa-concierge-bell"></i> Servicio</label>
                                    <select id="servicio">
                                        <option value="">Seleccione un servicio</option>
                                        <option value="Corte de cabello - RD$ 250">Corte de cabello - RD$ 250</option>
                                        <option value="Afeitado - RD$ 150">Afeitado - RD$ 150</option>
                                        <option value="Corte y barba - RD$ 350">Corte y barba - RD$ 350</option>
                                        <option value="Tinte - RD$ 400">Tinte - RD$ 400</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="precio"><i class="fas fa-dollar-sign"></i> Precio</label>
                                    <input type="number" id="precio" placeholder="RD$" />
                                </div>
                                <div class="form-group">
                                    <label for="fecha-hora"><i class="fas fa-calendar-alt"></i> Fecha y Hora</label>
                                    <input type="datetime-local" id="fecha-hora" />
                                </div>
                            </div>

                            <button class="btn btn-primary" id="saveAppointmentBtn">
                                <i class="fas fa-save"></i> Guardar Cita
                            </button>
                        </div>
                    </div>

                    <div class="tab-content" id="barberia-lista">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Barbero</th>
                                        <th>Servicio</th>
                                        <th>Hora</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="appointmentsTable">
                                    <!-- Las citas se cargarán dinámicamente desde IndexedDB -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="barberia-historial">
                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-busqueda">Fecha</label>
                                    <input type="date" id="fecha-busqueda" />
                                </div>
                                <div class="form-group">
                                    <label for="barbero-busqueda">Barbero</label>
                                    <select id="barbero-busqueda">
                                        <option value="">Todos los barberos</option>
                                        <option value="Anthony">Anthony</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="servicio-busqueda">Servicio</label>
                                <select id="servicio-busqueda">
                                    <option value="">Todos los servicios</option>
                                    <option value="Corte de cabello">Corte de cabello</option>
                                    <option value="Afeitado">Afeitado</option>
                                    <option value="Corte y barba">Corte y barba</option>
                                    <option value="Tinte">Tinte</option>
                                </select>
                            </div>

                            <button class="btn btn-primary" id="searchHistoryBtn">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>

                        <div class="table-container" style="margin-top: 20px">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Barbero</th>
                                        <th>Servicio</th>
                                        <th>Precio</th>
                                    </tr>
                                </thead>
                                <tbody id="historyTable">
                                    <!-- El historial se cargará dinámicamente desde IndexedDB -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Billar - Página Completa -->
                <div class="page" id="billar">
                    <div class="page-title">
                        <h1>Billar - Sistema POS</h1>
                        <button class="btn btn-secondary" id="newProductBtn">
                            <i class="fas fa-plus"></i> Nuevo Producto
                        </button>
                    </div>

                    <!-- Tabs de Billar -->
                    <div class="tabs">
                        <div class="tab active" data-tab="billar-inventario">Inventario</div>
                        <div class="tab" data-tab="billar-pos">Punto de Venta</div>
                        <div class="tab" data-tab="billar-ventas">Ventas del Día</div>
                        <div class="tab" data-tab="billar-reportes">Reportes</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="billar-inventario">
                        <div class="page-title">
                            <h2>Inventario de Productos</h2>
                            <div class="header-actions">
                                <button class="btn btn-outline" id="exportProductsBtn">
                                    <i class="fas fa-file-export"></i> Exportar
                                </button>
                                <button class="btn btn-primary" id="addProductBtn">
                                    <i class="fas fa-plus"></i> Agregar Producto
                                </button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Código</th>
                                        <th>Producto</th>
                                        <th>Categoría</th>
                                        <th>P. Compra</th>
                                        <th>P. Venta</th>
                                        <th>Stock</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTable">
                                    <!-- Los productos se cargarán dinámicamente desde IndexedDB -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-pos">
                        <div class="page-title">
                            <h2>Punto de Venta</h2>
                            <div class="header-actions">
                                <button class="btn btn-outline" id="clearCartBtn">
                                    <i class="fas fa-trash"></i> Limpiar
                                </button>
                            </div>
                        </div>

                        <div class="pos-container">
                            <div>
                                <div class="form-group">
                                    <label for="codigo-barra"><i class="fas fa-barcode"></i> Código de Barras</label>
                                    <input type="text" id="codigo-barra" placeholder="Escanear código de barras" />
                                </div>

                                <div class="form-group">
                                    <label for="buscar-producto"><i class="fas fa-search"></i> Buscar Producto</label>
                                    <input type="text" id="buscar-producto" placeholder="Buscar por nombre" />
                                </div>

                                <h3>Productos Disponibles</h3>
                                <div class="products-grid" id="productsGrid">
                                    <!-- Los productos para el POS se cargarán dinámicamente desde IndexedDB -->
                                </div>
                            </div>

                            <div class="cart">
                                <div class="cart-header">
                                    <div class="cart-title">Carrito de Venta</div>
                                    <div class="badge badge-info" id="cartCount">0 productos</div>
                                </div>

                                <div class="cart-items" id="cartItems">
                                    <!-- Los productos del carrito se cargarán dinámicamente -->
                                </div>

                                <div class="cart-total" id="cartTotal">Total: RD$ 0</div>

                                <div class="form-group">
                                    <label for="metodo-pago">Método de Pago</label>
                                    <select id="metodo-pago">
                                        <option value="efectivo">Efectivo</option>
                                        <option value="tarjeta">Tarjeta</option>
                                        <option value="transferencia">Transferencia</option>
                                    </select>
                                </div>

                                <button class="btn btn-primary btn-block" id="finalizarVentaBtn">
                                    <i class="fas fa-check"></i> Finalizar Venta
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-ventas">
                        <div class="page-title">
                            <h2>Ventas del Día</h2>
                            <div class="header-actions">
                                <button class="btn btn-outline" id="filterSalesBtn">
                                    <i class="fas fa-filter"></i> Filtrar
                                </button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Total</th>
                                        <th>Productos Vendidos</th>
                                        <th>Método de Pago</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="salesTable">
                                    <!-- Las ventas se cargarán dinámicamente desde IndexedDB -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="billar-reportes">
                        <div class="page-title">
                            <h2>Reportes</h2>
                            <div class="header-actions">
                                <button class="btn btn-success" id="exportExcelBtn">
                                    <i class="fas fa-file-excel"></i> Exportar a Excel
                                </button>
                                <button class="btn btn-danger" id="exportPdfBtn">
                                    <i class="fas fa-file-pdf"></i> Exportar a PDF
                                </button>
                            </div>
                        </div>

                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-inicio">Fecha Inicio</label>
                                    <input type="date" id="fecha-inicio" />
                                </div>
                                <div class="form-group">
                                    <label for="fecha-fin">Fecha Fin</label>
                                    <input type="date" id="fecha-fin" />
                                </div>
                            </div>

                            <button class="btn btn-primary" id="generateReportBtn">
                                <i class="fas fa-chart-bar"></i> Generar Reporte
                            </button>
                        </div>

                        <div class="stats" style="margin-top: 20px">
                            <div class="stat-card">
                                <h3>Total Vendido</h3>
                                <div class="stat-value" id="totalSold">RD$ 0</div>
                                <div class="stat-trend trend-up">
                                    <i class="fas fa-arrow-up"></i>
                                    <span id="soldTrend">0% más que la semana pasada</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <h3>Producto Más Vendido</h3>
                                <div class="stat-value" id="topProduct">-</div>
                                <div class="stat-trend">
                                    <span id="topProductCount">0 unidades</span>
                                </div>
                            </div>

                            <div class="stat-card">
                                <h3>Categoría Más Popular</h3>
                                <div class="stat-value" id="topCategory">-</div>
                                <div class="stat-trend">
                                    <span id="topCategoryPercent">0% de las ventas</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Car Wash - Página Completa -->
                <div class="page" id="carwash">
                    <div class="page-title">
                        <h1>Car Wash</h1>
                        <button class="btn btn-success" id="newVehicleBtn">
                            <i class="fas fa-plus"></i> Nuevo Vehículo
                        </button>
                    </div>

                    <!-- Tabs de Car Wash -->
                    <div class="tabs">
                        <div class="tab active" data-tab="carwash-registro">Registrar Vehículo</div>
                        <div class="tab" data-tab="carwash-proceso">Vehículos en Proceso</div>
                        <div class="tab" data-tab="carwash-entregados">Vehículos Entregados</div>
                        <div class="tab" data-tab="carwash-historial">Historial</div>
                    </div>

                    <!-- Contenido de las Tabs -->
                    <div class="tab-content active" id="carwash-registro">
                        <div class="form-container">
                            <div class="form-group">
                                <label for="tipo-vehiculo"><i class="fas fa-car"></i> Tipo de Vehículo</label>
                                <select id="tipo-vehiculo">
                                    <option value="">Seleccione tipo</option>
                                    <option value="carro">Carro</option>
                                    <option value="jeepeta">Jeepeta</option>
                                    <option value="motor">Motor</option>
                                    <option value="camion">Camión</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="numero-serie"><i class="fas fa-hashtag"></i> Número de Serie</label>
                                <input type="text" id="numero-serie" placeholder="Número de serie del vehículo" />
                            </div>

                            <div class="form-group">
                                <label for="servicio-vehiculo"><i class="fas fa-concierge-bell"></i> Servicio</label>
                                <select id="servicio-vehiculo">
                                    <option value="">Seleccione servicio</option>
                                    <option value="Lavado Básico - RD$ 300">Lavado Básico - RD$ 300</option>
                                    <option value="Lavado Completo - RD$ 450">Lavado Completo - RD$ 450</option>
                                    <option value="Lavado de Motor - RD$ 200">Lavado de Motor - RD$ 200</option>
                                    <option value="Pulido - RD$ 600">Pulido - RD$ 600</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="precio-vehiculo"><i class="fas fa-dollar-sign"></i> Precio</label>
                                    <input type="number" id="precio-vehiculo" placeholder="RD$" />
                                </div>
                                <div class="form-group">
                                    <label for="empleado-vehiculo"><i class="fas fa-user"></i> Empleado (Opcional)</label>
                                    <select id="empleado-vehiculo">
                                        <option value="">Seleccione empleado</option>
                                        <option value="1">Pedro Martínez</option>
                                        <option value="2">José Rodríguez</option>
                                        <option value="3">Ana Sánchez</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="hora-entrada"><i class="fas fa-clock"></i> Hora de Entrada</label>
                                <input type="datetime-local" id="hora-entrada" />
                            </div>

                            <button class="btn btn-success" id="saveVehicleBtn">
                                <i class="fas fa-save"></i> Registrar Vehículo
                            </button>
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-proceso">
                        <div class="vehicles-grid" id="vehiclesGrid">
                            <!-- Los vehículos en proceso se cargarán dinámicamente desde IndexedDB -->
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-entregados">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>N° Serie</th>
                                        <th>Tipo</th>
                                        <th>Servicio</th>
                                        <th>Precio</th>
                                        <th>Hora Entrada</th>
                                        <th>Hora Salida</th>
                                    </tr>
                                </thead>
                                <tbody id="completedVehiclesTable">
                                    <!-- Los vehículos entregados se cargarán dinámicamente desde IndexedDB -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="tab-content" id="carwash-historial">
                        <div class="form-container">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fecha-carwash">Fecha</label>
                                    <input type="date" id="fecha-carwash" />
                                </div>
                                <div class="form-group">
                                    <label for="tipo-filtro">Tipo de Vehículo</label>
                                    <select id="tipo-filtro">
                                        <option value="">Todos los tipos</option>
                                        <option value="carro">Carro</option>
                                        <option value="jeepeta">Jeepeta</option>
                                        <option value="motor">Motor</option>
                                        <option value="camion">Camión</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="servicio-filtro">Servicio</label>
                                <select id="servicio-filtro">
                                    <option value="">Todos los servicios</option>
                                    <option value="Lavado Básico">Lavado Básico</option>
                                    <option value="Lavado Completo">Lavado Completo</option>
                                    <option value="Lavado de Motor">Lavado de Motor</option>
                                    <option value="Pulido">Pulido</option>
                                </select>
                            </div>

                            <button class="btn btn-primary" id="searchCarwashBtn">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>

                        <div class="table-container" style="margin-top: 20px">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>N° Serie</th>
                                        <th>Tipo</th>
                                        <th>Servicio</th>
                                        <th>Precio</th>
                                    </tr>
                                </thead>
                                <tbody id="carwashHistoryTable">
                                    <!-- El historial se cargará dinámicamente desde IndexedDB -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Configuración - Tema -->
                <div class="page" id="config-tema">
                    <div class="page-title">
                        <h1>Configuración - Tema</h1>
                    </div>

                    <div class="form-container">
                        <div class="form-group">
                            <label for="select-tema">Seleccionar Tema</label>
                            <select id="select-tema">
                                <option value="dark">Oscuro</option>
                                <option value="light">Claro</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Vista Previa</label>
                            <div class="card">
                                <div class="card-icon barberia">
                                    <i class="fas fa-cut"></i>
                                </div>
                                <h3>Ejemplo de Tarjeta</h3>
                                <p>Esta es una vista previa del tema seleccionado</p>
                            </div>
                        </div>

                        <button class="btn btn-primary" id="saveThemeBtn">
                            <i class="fas fa-save"></i> Guardar Configuración
                        </button>
                    </div>
                </div>

                <!-- Configuración - Usuarios -->
                <div class="page" id="config-usuarios">
                    <div class="page-title">
                        <h1>Configuración - Usuarios</h1>
                        <button class="btn btn-primary" id="addUserBtn">
                            <i class="fas fa-plus"></i> Agregar Usuario
                        </button>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Usuario</th>
                                    <th>Nombre</th>
                                    <th>Rol</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <!-- Los usuarios se cargarán dinámicamente desde IndexedDB -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para agregar producto -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Agregar Nuevo Producto</div>
                <button class="modal-close" id="closeProductModal">&times;</button>
            </div>
            <div class="form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="codigo-barra-producto">Código de Barras</label>
                        <input type="text" id="codigo-barra-producto" placeholder="Ingrese código de barras" />
                    </div>
                    <div class="form-group">
                        <label for="nombre-producto">Nombre del Producto</label>
                        <input type="text" id="nombre-producto" placeholder="Ingrese nombre del producto" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="categoria-producto">Categoría</label>
                        <select id="categoria-producto">
                            <option value="">Seleccione categoría</option>
                            <option value="bebidas">Bebidas</option>
                            <option value="snacks">Snacks</option>
                            <option value="licores">Licores</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fecha-ingreso">Fecha de Ingreso</label>
                        <input type="date" id="fecha-ingreso" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="precio-compra">Precio de Compra</label>
                        <input type="number" id="precio-compra" placeholder="RD$" />
                    </div>
                    <div class="form-group">
                        <label for="precio-venta">Precio de Venta</label>
                        <input type="number" id="precio-venta" placeholder="RD$" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cantidad-stock">Cantidad en Stock</label>
                        <input type="number" id="cantidad-stock" placeholder="Cantidad" />
                    </div>
                    <div class="form-group">
                        <label for="alerta-stock">Alerta de Stock</label>
                        <input type="number" id="alerta-stock" placeholder="Mínimo" />
                    </div>
                </div>

                <button class="btn btn-primary" id="saveProductBtn">
                    <i class="fas fa-save"></i> Guardar Producto
                </button>
            </div>
        </div>
    </div>

    <!-- Container for alerts -->
    <div class="alert-container" id="alertContainer"></div>

    <script>
        // =============================================
        // CONFIGURACIÓN DE INDEXEDDB
        // =============================================

        const DB_NAME = "StarkCleaneDB";
        const DB_VERSION = 3;
        let db;

        // Nombres de los object stores
        const STORES = {
            APPOINTMENTS: "appointments",
            PRODUCTS: "products",
            VEHICLES: "vehicles",
            SALES: "sales",
            COMPLETED_VEHICLES: "completed_vehicles",
            USERS: "users",
            SETTINGS: "settings"
        };

        // Inicializar la base de datos
        function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => {
                    console.error("Error al abrir la base de datos");
                    reject(request.error);
                };

                request.onsuccess = () => {
                    db = request.result;
                    console.log("Base de datos abierta correctamente");
                    resolve(db);
                };

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    console.log("Actualizando base de datos a versión:", DB_VERSION);

                    // Crear object stores si no existen
                    if (!db.objectStoreNames.contains(STORES.APPOINTMENTS)) {
                        const store = db.createObjectStore(STORES.APPOINTMENTS, {
                            keyPath: "id",
                            autoIncrement: true,
                        });
                        store.createIndex("fecha", "fecha", { unique: false });
                    }

                    if (!db.objectStoreNames.contains(STORES.PRODUCTS)) {
                        const store = db.createObjectStore(STORES.PRODUCTS, {
                            keyPath: "id",
                            autoIncrement: true,
                        });
                        store.createIndex("categoria", "categoria", { unique: false });
                    }

                    if (!db.objectStoreNames.contains(STORES.VEHICLES)) {
                        const store = db.createObjectStore(STORES.VEHICLES, {
                            keyPath: "id",
                            autoIncrement: true,
                        });
                        store.createIndex("estado", "estado", { unique: false });
                    }

                    if (!db.objectStoreNames.contains(STORES.SALES)) {
                        const store = db.createObjectStore(STORES.SALES, {
                            keyPath: "id",
                            autoIncrement: true,
                        });
                        store.createIndex("fecha", "fecha", { unique: false });
                    }

                    if (!db.objectStoreNames.contains(STORES.COMPLETED_VEHICLES)) {
                        db.createObjectStore(STORES.COMPLETED_VEHICLES, {
                            keyPath: "id",
                            autoIncrement: true,
                        });
                    }

                    if (!db.objectStoreNames.contains(STORES.USERS)) {
                        const store = db.createObjectStore(STORES.USERS, {
                            keyPath: "id",
                            autoIncrement: true,
                        });
                        store.createIndex("usuario", "usuario", { unique: true });
                    }

                    if (!db.objectStoreNames.contains(STORES.SETTINGS)) {
                        db.createObjectStore(STORES.SETTINGS, {
                            keyPath: "id",
                            autoIncrement: true,
                        });
                    }
                };
            });
        }

        // Función genérica para agregar datos
        function addData(storeName, data) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject(new Error("Base de datos no inicializada"));
                    return;
                }
                
                const transaction = db.transaction([storeName], "readwrite");
                const store = transaction.objectStore(storeName);
                const request = store.add(data);

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // Función genérica para obtener todos los datos
        function getAllData(storeName) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject(new Error("Base de datos no inicializada"));
                    return;
                }
                
                const transaction = db.transaction([storeName], "readonly");
                const store = transaction.objectStore(storeName);
                const request = store.getAll();

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // Función genérica para eliminar datos
        function deleteData(storeName, id) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject(new Error("Base de datos no inicializada"));
                    return;
                }
                
                const transaction = db.transaction([storeName], "readwrite");
                const store = transaction.objectStore(storeName);
                const request = store.delete(id);

                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        // Función genérica para actualizar datos
        function updateData(storeName, data) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    reject(new Error("Base de datos no inicializada"));
                    return;
                }
                
                const transaction = db.transaction([storeName], "readwrite");
                const store = transaction.objectStore(storeName);
                const request = store.put(data);

                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        // =============================================
        // SISTEMA DE LOGIN Y REGISTRO
        // =============================================

        // Verificar credenciales de usuario
        async function checkCredentials(username, password) {
            try {
                const users = await getAllData(STORES.USERS);
                const user = users.find(u => u.usuario === username && u.password === password);
                return user || null;
            } catch (error) {
                console.error("Error al verificar credenciales:", error);
                return null;
            }
        }

        // Registrar nuevo usuario
        async function registerUser(user) {
            try {
                // Verificar si el usuario ya existe
                const users = await getAllData(STORES.USERS);
                const existingUser = users.find(u => u.usuario === user.usuario);
                
                if (existingUser) {
                    throw new Error("El usuario ya existe");
                }
                
                // Guardar el nuevo usuario
                const id = await addData(STORES.USERS, user);
                return id;
            } catch (error) {
                console.error("Error al registrar usuario:", error);
                throw error;
            }
        }

        // =============================================
        // INICIALIZACIÓN DE LA APLICACIÓN
        // =============================================

        // Inicializar la aplicación
        async function initApp() {
            try {
                // Inicializar IndexedDB
                await initDB();
                
                // Verificar si hay usuarios, si no, agregar uno por defecto
                const users = await getAllData(STORES.USERS);
                if (users.length === 0) {
                    const defaultUser = {
                        usuario: "admin",
                        password: "admin123",
                        nombre: "Administrador",
                        rol: "admin",
                        activo: true
                    };
                    await addData(STORES.USERS, defaultUser);
                    console.log("Usuario por defecto creado");
                }
                
                // Cargar datos iniciales
                await loadAppointments();
                await loadProducts();
                await loadVehicles();
                await loadSales();
                await loadUsers();

                // Inicializar gráficos
                initializeCharts();

                // Inicializar carrito
                updateCartUI();

                showNotification("Sistema cargado correctamente", "success");
            } catch (error) {
                console.error("Error al inicializar la aplicación:", error);
                showNotification("Error al cargar el sistema", "error");
            }
        }

        // =============================================
        // FUNCIONES ESPECÍFICAS PARA CADA MÓDULO
        // =============================================

        // Barbería
        async function saveAppointment(appointment) {
            appointment.fecha = new Date().toISOString();
            const id = await addData(STORES.APPOINTMENTS, appointment);
            await loadAppointments();
            return id;
        }

        async function loadAppointments() {
            try {
                const appointments = await getAllData(STORES.APPOINTMENTS);
                updateAppointmentsTable(appointments);
                updateDashboardStats();
                return appointments;
            } catch (error) {
                console.error("Error al cargar citas:", error);
                return [];
            }
        }

        async function deleteAppointment(id) {
            await deleteData(STORES.APPOINTMENTS, id);
            await loadAppointments();
        }

        // Billar - Productos
        async function saveProduct(product) {
            product.fecha_ingreso = new Date().toISOString();
            const id = await addData(STORES.PRODUCTS, product);
            await loadProducts();
            return id;
        }

        async function loadProducts() {
            try {
                const products = await getAllData(STORES.PRODUCTS);
                updateProductsTable(products);
                updateProductsGrid(products);
                updateDashboardStats();
                checkStockAlerts(products);
                return products;
            } catch (error) {
                console.error("Error al cargar productos:", error);
                return [];
            }
        }

        async function deleteProduct(id) {
            await deleteData(STORES.PRODUCTS, id);
            await loadProducts();
        }

        // Car Wash
        async function saveVehicle(vehicle) {
            vehicle.estado = "proceso";
            vehicle.hora_entrada = new Date().toISOString();
            const id = await addData(STORES.VEHICLES, vehicle);
            await loadVehicles();
            return id;
        }

        async function loadVehicles() {
            try {
                const vehicles = await getAllData(STORES.VEHICLES);
                updateVehiclesGrid(vehicles);
                updateCompletedVehicles();
                updateDashboardStats();
                return vehicles;
            } catch (error) {
                console.error("Error al cargar vehículos:", error);
                return [];
            }
        }

        async function markVehicleAsCompleted(vehicleId) {
            const vehicles = await getAllData(STORES.VEHICLES);
            const vehicle = vehicles.find((v) => v.id === vehicleId);

            if (vehicle) {
                vehicle.estado = "completado";
                vehicle.hora_salida = new Date().toISOString();

                // Mover a completed_vehicles
                await addData(STORES.COMPLETED_VEHICLES, vehicle);

                // Eliminar de vehicles
                await deleteData(STORES.VEHICLES, vehicleId);

                await loadVehicles();
            }
        }

        async function loadCompletedVehicles() {
            return await getAllData(STORES.COMPLETED_VEHICLES);
        }

        // Ventas
        async function saveSale(sale) {
            sale.fecha = new Date().toISOString();
            const id = await addData(STORES.SALES, sale);
            await loadSales();
            
            // Actualizar stock de productos vendidos
            if (sale.productos) {
                for (const item of sale.productos) {
                    await updateProductStock(item.productId, item.quantity);
                }
            }
            
            return id;
        }

        async function updateProductStock(productId, quantitySold) {
            const products = await getAllData(STORES.PRODUCTS);
            const product = products.find(p => p.id === productId);
            
            if (product) {
                product.stock -= quantitySold;
                await updateData(STORES.PRODUCTS, product);
                await loadProducts(); // Recargar productos para actualizar alertas
            }
        }

        async function loadSales() {
            try {
                const sales = await getAllData(STORES.SALES);
                updateSalesTable(sales);
                updateDashboardStats();
                return sales;
            } catch (error) {
                console.error("Error al cargar ventas:", error);
                return [];
            }
        }

        // Usuarios
        async function saveUser(user) {
            const id = await addData(STORES.USERS, user);
            await loadUsers();
            return id;
        }

        async function loadUsers() {
            try {
                const users = await getAllData(STORES.USERS);
                updateUsersTable(users);
                return users;
            } catch (error) {
                console.error("Error al cargar usuarios:", error);
                return [];
            }
        }

        async function deleteUser(id) {
            await deleteData(STORES.USERS, id);
            await loadUsers();
        }

        // =============================================
        // ACTUALIZACIÓN DE LA INTERFAZ
        // =============================================

        // Actualizar tabla de citas
        function updateAppointmentsTable(appointments) {
            const tableBody = document.getElementById("appointmentsTable");
            tableBody.innerHTML = "";

            appointments.forEach((appointment) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${appointment.cliente}</td>
                    <td>${appointment.barbero}</td>
                    <td>${appointment.servicio}</td>
                    <td>${appointment.hora}</td>
                    <td><span class="badge badge-warning"><i class="fas fa-clock"></i> Pendiente</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-success btn-sm complete-appointment" data-id="${appointment.id}"><i class="fas fa-check"></i></button>
                        <button class="btn btn-danger btn-sm delete-appointment" data-id="${appointment.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Agregar event listeners a los botones
            document.querySelectorAll(".complete-appointment").forEach((button) => {
                button.addEventListener("click", function () {
                    const id = parseInt(this.getAttribute("data-id"));
                    completeAppointment(id);
                });
            });

            document.querySelectorAll(".delete-appointment").forEach((button) => {
                button.addEventListener("click", function () {
                    const id = parseInt(this.getAttribute("data-id"));
                    deleteAppointment(id);
                });
            });
        }

        // Completar cita
        async function completeAppointment(id) {
            const appointments = await getAllData(STORES.APPOINTMENTS);
            const appointment = appointments.find(a => a.id === id);
            
            if (appointment) {
                // Imprimir factura
                printReceipt(appointment, 'barberia');
                
                // Eliminar cita
                await deleteAppointment(id);
                
                showNotification("Cita completada y factura impresa", "success");
            }
        }

        // Actualizar tabla de productos
        function updateProductsTable(products) {
            const tableBody = document.getElementById("productsTable");
            tableBody.innerHTML = "";

            products.forEach((product) => {
                const estado = product.stock > (product.alerta_stock || 10) ? "Disponible" : "Bajo Stock";
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${product.codigo}</td>
                    <td>${product.nombre}</td>
                    <td>${product.categoria}</td>
                    <td>RD$ ${product.precio_compra}</td>
                    <td>RD$ ${product.precio_venta}</td>
                    <td>${product.stock}</td>
                    <td><span class="badge ${estado === "Disponible" ? "badge-success" : "badge-warning"}">${estado}</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-outline btn-sm edit-product"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm delete-product" data-id="${product.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Agregar event listeners a los botones de eliminar
            document.querySelectorAll(".delete-product").forEach((button) => {
                button.addEventListener("click", function () {
                    const id = parseInt(this.getAttribute("data-id"));
                    deleteProduct(id);
                });
            });
        }

        // Actualizar grid de productos para POS
        function updateProductsGrid(products) {
            const grid = document.getElementById("productsGrid");
            grid.innerHTML = "";

            products.forEach((product) => {
                const card = document.createElement("div");
                card.className = "product-card";
                card.setAttribute("data-id", product.id);
                card.innerHTML = `
                    <div class="product-image">
                        <i class="fas fa-${getProductIcon(product.categoria)}"></i>
                    </div>
                    <h4>${product.nombre}</h4>
                    <p>RD$ ${product.precio_venta}</p>
                `;
                grid.appendChild(card);
            });

            // Agregar event listeners a las tarjetas de productos
            document.querySelectorAll(".product-card").forEach((card) => {
                card.addEventListener("click", function () {
                    const productId = parseInt(this.getAttribute("data-id"));
                    addToCart(productId);
                });
            });
        }

        // Obtener icono según categoría
        function getProductIcon(categoria) {
            const icons = {
                bebidas: "wine-bottle",
                snacks: "cookie",
                licores: "glass-whiskey",
                otros: "box",
            };
            return icons[categoria] || "box";
        }

        // Actualizar grid de vehículos
        function updateVehiclesGrid(vehicles) {
            const grid = document.getElementById("vehiclesGrid");
            grid.innerHTML = "";

            const vehiclesInProcess = vehicles.filter((v) => v.estado === "proceso");

            vehiclesInProcess.forEach((vehicle) => {
                const card = document.createElement("div");
                card.className = "vehicle-card";
                card.innerHTML = `
                    <div class="vehicle-header">
                        <div class="vehicle-placa">${vehicle.numero_serie}</div>
                        <span class="vehicle-type ${vehicle.tipo}">${vehicle.tipo}</span>
                    </div>
                    <div class="vehicle-details">
                        <div class="vehicle-detail">
                            <span>Servicio:</span>
                            <span>${vehicle.servicio}</span>
                        </div>
                        <div class="vehicle-detail">
                            <span>Precio:</span>
                            <span>${vehicle.precio}</span>
                        </div>
                        <div class="vehicle-detail">
                            <span>Empleado:</span>
                            <span>${vehicle.empleado || "No asignado"}</span>
                        </div>
                    </div>
                    <p class="vehicle-time"><i class="fas fa-clock"></i> Tiempo transcurrido: ${calculateTimeElapsed(vehicle.hora_entrada)}</p>
                    <button class="btn btn-success btn-block mark-ready" data-id="${vehicle.id}">
                        <i class="fas fa-check"></i> Marcar como Listo
                    </button>
                `;
                grid.appendChild(card);
            });

            // Agregar event listeners a los botones de marcar como listo
            document.querySelectorAll(".mark-ready").forEach((button) => {
                button.addEventListener("click", function () {
                    const vehicleId = parseInt(this.getAttribute("data-id"));
                    completeVehicleService(vehicleId);
                });
            });
        }

        // Completar servicio de vehículo
        async function completeVehicleService(vehicleId) {
            const vehicles = await getAllData(STORES.VEHICLES);
            const vehicle = vehicles.find((v) => v.id === vehicleId);

            if (vehicle) {
                // Imprimir factura
                printReceipt(vehicle, 'carwash');
                
                // Marcar como completado
                await markVehicleAsCompleted(vehicleId);
                
                showNotification("Servicio completado y factura impresa", "success");
            }
        }

        // Calcular tiempo transcurrido
        function calculateTimeElapsed(startTime) {
            const start = new Date(startTime);
            const now = new Date();
            const diffMs = now - start;
            const diffMins = Math.floor(diffMs / 60000);
            return `${diffMins} min`;
        }

        // Actualizar vehículos completados
        async function updateCompletedVehicles() {
            const completedVehicles = await loadCompletedVehicles();
            const tableBody = document.getElementById("completedVehiclesTable");
            tableBody.innerHTML = "";

            completedVehicles.forEach((vehicle) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${vehicle.numero_serie}</td>
                    <td><span class="badge badge-info">${vehicle.tipo}</span></td>
                    <td>${vehicle.servicio}</td>
                    <td>${vehicle.precio}</td>
                    <td>${formatTime(vehicle.hora_entrada)}</td>
                    <td>${formatTime(vehicle.hora_salida)}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Formatear tiempo
        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString("es-ES", {
                hour: "2-digit",
                minute: "2-digit",
            });
        }

        // Actualizar tabla de ventas
        function updateSalesTable(sales) {
            const tableBody = document.getElementById("salesTable");
            tableBody.innerHTML = "";

            sales.forEach((sale) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${formatTime(sale.fecha)}</td>
                    <td>${sale.total}</td>
                    <td>${sale.productos ? sale.productos.map(p => p.nombre).join(', ') : 'N/A'}</td>
                    <td><span class="badge badge-success">${sale.metodo_pago}</span></td>
                    <td>
                        <button class="btn btn-outline btn-sm reprint-ticket" data-id="${sale.id}">
                            <i class="fas fa-print"></i> Reimprimir
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Agregar event listeners a los botones de reimprimir
            document.querySelectorAll(".reprint-ticket").forEach((button) => {
                button.addEventListener("click", function () {
                    const saleId = parseInt(this.getAttribute("data-id"));
                    reprintTicket(saleId);
                });
            });
        }

        // Reimprimir ticket
        async function reprintTicket(saleId) {
            const sales = await getAllData(STORES.SALES);
            const sale = sales.find(s => s.id === saleId);
            
            if (sale) {
                printReceipt(sale, 'billar');
                showNotification("Ticket reimpreso", "success");
            }
        }

        // Actualizar tabla de usuarios
        function updateUsersTable(users) {
            const tableBody = document.getElementById("usersTable");
            tableBody.innerHTML = "";

            users.forEach((user) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${user.usuario}</td>
                    <td>${user.nombre}</td>
                    <td>${user.rol}</td>
                    <td><span class="badge badge-success">Activo</span></td>
                    <td class="action-buttons">
                        <button class="btn btn-outline btn-sm edit-user"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-danger btn-sm delete-user" data-id="${user.id}"><i class="fas fa-trash"></i></button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Agregar event listeners a los botones de eliminar
            document.querySelectorAll(".delete-user").forEach((button) => {
                button.addEventListener("click", function () {
                    const id = parseInt(this.getAttribute("data-id"));
                    deleteUser(id);
                });
            });
        }

        // Actualizar estadísticas del dashboard
        async function updateDashboardStats() {
            const appointments = await getAllData(STORES.APPOINTMENTS);
            const products = await getAllData(STORES.PRODUCTS);
            const vehicles = await getAllData(STORES.VEHICLES);
            const sales = await getAllData(STORES.SALES);

            // Actualizar contadores
            document.getElementById("appointmentsCount").textContent = appointments.length;
            document.getElementById("vehiclesCount").textContent = vehicles.filter((v) => v.estado === "proceso").length;

            // Calcular total de ventas
            const totalSales = sales.reduce((sum, sale) => {
                const amount = parseFloat(sale.total.replace("RD$ ", "")) || 0;
                return sum + amount;
            }, 0);

            document.getElementById("salesTotal").textContent = `RD$ ${totalSales.toLocaleString()}`;
            document.getElementById("dailyIncome").textContent = `RD$ ${totalSales.toLocaleString()}`;

            // Actualizar otros contadores
            document.getElementById("customersCount").textContent = appointments.length;
            document.getElementById("productsSold").textContent = products.reduce((sum, product) => sum + (product.vendidos || 0), 0);

            // Actualizar tendencias (simuladas)
            document.getElementById("appointmentsTrend").textContent = `${Math.floor(appointments.length * 0.2)} citas hoy`;
            document.getElementById("salesTrend").textContent = `${Math.floor(totalSales * 0.15)}% más que ayer`;
            document.getElementById("vehiclesTrend").textContent = `${Math.floor(vehicles.length * 0.1)} menos que ayer`;
            document.getElementById("incomeTrend").textContent = `${Math.floor(totalSales * 0.12)}% más que ayer`;
            document.getElementById("customersTrend").textContent = `${Math.floor(appointments.length * 0.05)}% más que ayer`;
            document.getElementById("productsTrend").textContent = `${Math.floor(products.length * 0.03)}% menos que ayer`;

            // Actualizar reportes
            document.getElementById("totalSold").textContent = `RD$ ${totalSales.toLocaleString()}`;
            document.getElementById("soldTrend").textContent = `${Math.floor(totalSales * 0.08)}% más que la semana pasada`;

            // Producto más vendido (simulado)
            document.getElementById("topProduct").textContent = products.length > 0 ? products[0].nombre : "-";
            document.getElementById("topProductCount").textContent = products.length > 0 ? `${products[0].vendidos || 0} unidades` : "0 unidades";

            // Categoría más popular (simulado)
            document.getElementById("topCategory").textContent = "Bebidas";
            document.getElementById("topCategoryPercent").textContent = "62% de las ventas";
        }

        // =============================================
        // SISTEMA DE ALERTAS DE STOCK
        // =============================================

        function checkStockAlerts(products) {
            const alertContainer = document.getElementById('alertContainer');
            
            // Limpiar alertas existentes
            alertContainer.innerHTML = '';
            
            products.forEach(product => {
                if (product.stock <= (product.alerta_stock || 10)) {
                    showStockAlert(product);
                }
            });
        }

        function showStockAlert(product) {
            const alertContainer = document.getElementById('alertContainer');
            
            const alert = document.createElement('div');
            alert.className = 'stock-alert';
            alert.innerHTML = `
                <div class="alert-content">
                    <i class="fas fa-exclamation-triangle alert-icon"></i>
                    <div>
                        <strong>Alerta de Stock Bajo</strong>
                        <p>${product.nombre} - Stock: ${product.stock} (Mínimo: ${product.alerta_stock || 10})</p>
                    </div>
                </div>
                <button class="alert-close" data-id="${product.id}">&times;</button>
            `;
            
            alertContainer.appendChild(alert);
            
            // Agregar event listener para cerrar la alerta
            alert.querySelector('.alert-close').addEventListener('click', function() {
                alert.remove();
            });
        }

        // =============================================
        // SISTEMA DE FACTURACIÓN
        // =============================================

        function printReceipt(saleData, type) {
            const receiptContent = generateReceiptHTML(saleData, type);
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Factura - Stark Cleane</title>
                    <style>
                        body {
                            font-family: 'Courier New', monospace;
                            font-size: 14px;
                            line-height: 1.4;
                            margin: 0;
                            padding: 20px;
                        }
                        .receipt {
                            width: 300px;
                            max-width: 100%;
                        }
                        .receipt-header {
                            text-align: center;
                            margin-bottom: 15px;
                            border-bottom: 1px dashed #333;
                            padding-bottom: 10px;
                        }
                        .receipt-logo {
                            font-weight: bold;
                            font-size: 18px;
                            margin-bottom: 5px;
                        }
                        .receipt-details {
                            margin-bottom: 15px;
                        }
                        .receipt-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 15px;
                        }
                        .receipt-table th,
                        .receipt-table td {
                            padding: 4px 0;
                            border-bottom: 1px dashed #ccc;
                        }
                        .receipt-table th {
                            text-align: left;
                        }
                        .receipt-table td:last-child {
                            text-align: right;
                        }
                        .receipt-total {
                            text-align: right;
                            font-weight: bold;
                            margin-top: 10px;
                            padding-top: 10px;
                            border-top: 1px dashed #333;
                        }
                    </style>
                </head>
                <body>
                    ${receiptContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        function generateReceiptHTML(saleData, type) {
            let itemsHTML = '';
            let total = 0;
            
            if (type === 'billar') {
                saleData.productos.forEach(item => {
                    const itemTotal = item.precio * item.cantidad;
                    total += itemTotal;
                    itemsHTML += `
                        <tr>
                            <td>${item.nombre}</td>
                            <td>${item.cantidad}</td>
                            <td>RD$ ${item.precio}</td>
                            <td>RD$ ${itemTotal}</td>
                        </tr>
                    `;
                });
            } else if (type === 'barberia') {
                total = parseFloat(saleData.precio.replace('RD$ ', ''));
                itemsHTML = `
                    <tr>
                        <td>${saleData.servicio}</td>
                        <td>1</td>
                        <td>${saleData.precio}</td>
                        <td>${saleData.precio}</td>
                    </tr>
                `;
            } else if (type === 'carwash') {
                total = parseFloat(saleData.precio.replace('RD$ ', ''));
                itemsHTML = `
                    <tr>
                        <td>${saleData.servicio}</td>
                        <td>1</td>
                        <td>${saleData.precio}</td>
                        <td>${saleData.precio}</td>
                    </tr>
                `;
            }
            
            return `
                <div class="receipt">
                    <div class="receipt-header">
                        <div class="receipt-logo">Detailing Stark Cleaner</div>
                        <div>Dirección • Tel: +1(829) 272-5182</div>
                        <div>RNC: 000-0000000-0</div>
                    </div>
                    
                    <div class="receipt-details">
                        <div><strong>Fecha:</strong> ${new Date().toLocaleDateString()}</div>
                        <div><strong>Hora:</strong> ${new Date().toLocaleTimeString()}</div>
                        <div><strong>Tipo:</strong> ${type === 'billar' ? 'Venta Billar' : type === 'barberia' ? 'Servicio Barbería' : 'Servicio Car Wash'}</div>
                    </div>
                    
                    <table class="receipt-table">
                        <thead>
                            <tr>
                                <th>Descripción</th>
                                <th>Cant</th>
                                <th>Precio</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>
                    
                    <div class="receipt-total">
                        <div>Total: RD$ ${total}</div>
                        <div>Método de Pago: ${saleData.metodo_pago || 'Efectivo'}</div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <div>¡Gracias por su preferencia!</div>
                    </div>
                </div>
            `;
        }

        // =============================================
        // FUNCIONALIDADES GENERALES
        // =============================================

        // Mostrar notificación
        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement("div");
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === "success" ? "check-circle" : "exclamation-circle"}"></i>
                    <span>${message}</span>
                </div>
            `;

            // Add notification to body
            document.body.appendChild(notification);

            // Remove notification after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Inicializar gráficos
        function initializeCharts() {
            // Sales Chart
            const salesCtx = document.getElementById("salesChart").getContext("2d");
            if (salesCtx) {
                const salesChart = new Chart(salesCtx, {
                    type: "line",
                    data: {
                        labels: ["Lun", "Mar", "Mié", "Jue", "Vie", "Sáb", "Dom"],
                        datasets: [
                            {
                                label: "Ventas (RD$)",
                                data: [12000, 19000, 15000, 25000, 22000, 30000, 28000],
                                borderColor: "#1a73e8",
                                backgroundColor: "rgba(26, 115, 232, 0.1)",
                                borderWidth: 2,
                                tension: 0.4,
                                fill: true,
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: "top",
                            },
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: "rgba(255, 255, 255, 0.1)",
                                },
                            },
                            x: {
                                grid: {
                                    color: "rgba(255, 255, 255, 0.1)",
                                },
                            },
                        },
                    },
                });
            }
        }

        // =============================================
        // EVENT LISTENERS
        // =============================================

        // Login form
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = await checkCredentials(username, password);
            
            if (user) {
                // Ocultar login, mostrar aplicación
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'flex';
                
                // Actualizar información de usuario
                document.getElementById('userName').textContent = user.nombre;
                document.getElementById('userRole').textContent = user.rol === 'admin' ? 'Administrador' : 
                    user.rol === 'barbero' ? 'Barbero' : 'Vendedor';
                document.getElementById('userAvatar').textContent = user.nombre.charAt(0).toUpperCase();
                
                // Inicializar aplicación
                initApp();
            } else {
                showNotification('Usuario o contraseña incorrectos', 'error');
            }
        });

        // Mostrar modal de registro
        document.getElementById('showRegisterBtn').addEventListener('click', function() {
            document.getElementById('registerModal').classList.add('active');
        });

        // Cerrar modal de registro
        document.getElementById('closeRegisterModal').addEventListener('click', function() {
            document.getElementById('registerModal').classList.remove('active');
        });

        // Registrar usuario
        document.getElementById('registerBtn').addEventListener('click', async function() {
            const usuario = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const nombre = document.getElementById('register-nombre').value;
            const rol = document.getElementById('register-rol').value;

            if (usuario && password && nombre && rol) {
                try {
                    const user = {
                        usuario: usuario,
                        password: password,
                        nombre: nombre,
                        rol: rol,
                        activo: true
                    };

                    await registerUser(user);
                    document.getElementById('registerModal').classList.remove('active');
                    showNotification("Usuario registrado correctamente", "success");

                    // Limpiar el formulario
                    document.getElementById('register-username').value = '';
                    document.getElementById('register-password').value = '';
                    document.getElementById('register-nombre').value = '';
                    document.getElementById('register-rol').value = 'admin';
                } catch (error) {
                    showNotification(error.message, "error");
                }
            } else {
                showNotification("Por favor, complete todos los campos", "error");
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', function() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            
            // Limpiar campos de login
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        });

        // Toggle sidebar on mobile
        document.querySelector(".hamburger").addEventListener("click", function () {
            document.querySelector(".sidebar").classList.toggle("active");
        });

        // Toggle dark/light mode
        document.getElementById("themeToggle").addEventListener("click", function () {
            if (document.body.classList.contains("dark-mode")) {
                document.body.classList.remove("dark-mode");
                document.body.classList.add("light-mode");
                document.getElementById("themeToggle").innerHTML = '<i class="fas fa-sun"></i>';
                document.getElementById("select-tema").value = "light";
            } else {
                document.body.classList.remove("light-mode");
                document.body.classList.add("dark-mode");
                document.getElementById("themeToggle").innerHTML = '<i class="fas fa-moon"></i>';
                document.getElementById("select-tema").value = "dark";
            }
        });

        // Toggle submenus
        document.querySelectorAll(".menu-item[data-submenu]").forEach((item) => {
            item.addEventListener("click", function () {
                const submenuId = this.getAttribute("data-submenu") + "-submenu";
                document.getElementById(submenuId).classList.toggle("active");
                this.querySelector(".fa-chevron-down").classList.toggle("fa-chevron-up");
            });
        });

        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll(".page").forEach((page) => {
                page.classList.remove("active");
            });

            // Show selected page
            const pageElement = document.getElementById(pageId);
            if (pageElement) {
                pageElement.classList.add("active");
            }

            // Update active menu item
            document.querySelectorAll(".menu-item").forEach((menuItem) => {
                menuItem.classList.remove("active");
            });

            // Find and activate the corresponding menu item
            const activeMenuItem = document.querySelector(`.menu-item[data-page="${pageId}"]`);
            if (activeMenuItem) {
                activeMenuItem.classList.add("active");
            }

            // Update header title
            const pageTitles = {
                dashboard: "Dashboard",
                barberia: "Barbería",
                billar: "Billar - Sistema POS",
                carwash: "Car Wash",
                "config-tema": "Configuración - Tema",
                "config-usuarios": "Configuración - Usuarios"
            };

            document.getElementById("headerTitle").textContent = pageTitles[pageId] || "STARK CLEANE";

            // Close sidebar on mobile after selection
            if (window.innerWidth < 1200) {
                document.querySelector(".sidebar").classList.remove("active");
            }

            // Reset all tabs to first tab when changing pages
            if (pageId === "barberia" || pageId === "billar" || pageId === "carwash") {
                resetTabs(pageId);
            }
        }

        // Reset tabs to first tab
        function resetTabs(pageId) {
            const tabsContainer = document.querySelector(`#${pageId} .tabs`);
            if (tabsContainer) {
                const firstTab = tabsContainer.querySelector(".tab");
                if (firstTab) {
                    activateTab(firstTab.getAttribute("data-tab"));
                }
            }
        }

        // Activate specific tab
        function activateTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll(".tab-content").forEach((tabContent) => {
                tabContent.classList.remove("active");
            });

            // Show selected tab content
            const activeTabContent = document.getElementById(tabId);
            if (activeTabContent) {
                activeTabContent.classList.add("active");
            }

            // Update active tab
            document.querySelectorAll(".tab").forEach((tab) => {
                tab.classList.remove("active");
            });

            const activeTab = document.querySelector(`.tab[data-tab="${tabId}"]`);
            if (activeTab) {
                activeTab.classList.add("active");
            }
        }

        // Set up event listeners for menu items
        document.querySelectorAll(".menu-item, .submenu-item").forEach((item) => {
            item.addEventListener("click", function () {
                if (this.getAttribute("data-page")) {
                    const pageId = this.getAttribute("data-page");
                    showPage(pageId);
                }
            });
        });

        // Set up event listeners for dashboard cards
        document.querySelectorAll(".dashboard-cards .card").forEach((card) => {
            card.addEventListener("click", function () {
                const pageId = this.getAttribute("data-page");
                if (pageId) {
                    showPage(pageId);
                }
            });
        });

        // Set up event listeners for tabs
        document.querySelectorAll(".tab").forEach((tab) => {
            tab.addEventListener("click", function () {
                const tabId = this.getAttribute("data-tab");
                activateTab(tabId);
            });
        });

        // Save appointment
        document.getElementById("saveAppointmentBtn").addEventListener("click", async function () {
            const nombre = document.getElementById("nombre").value;
            const telefono = document.getElementById("telefono").value;
            const barbero = document.getElementById("barbero").value;
            const servicio = document.getElementById("servicio").value;
            const precio = document.getElementById("precio").value;
            const fechaHora = document.getElementById("fecha-hora").value;

            if (nombre && telefono && barbero && servicio && precio && fechaHora) {
                const appointment = {
                    cliente: nombre,
                    telefono: telefono,
                    barbero: barbero,
                    servicio: servicio.split(" - ")[0],
                    precio: `RD$ ${precio}`,
                    hora: new Date(fechaHora).toLocaleTimeString("es-ES", {
                        hour: "2-digit",
                        minute: "2-digit",
                    }),
                };

                await saveAppointment(appointment);

                // Clear the form
                document.getElementById("nombre").value = "";
                document.getElementById("telefono").value = "";
                document.getElementById("barbero").value = "Anthony";
                document.getElementById("servicio").value = "";
                document.getElementById("precio").value = "";
                document.getElementById("fecha-hora").value = "";
                
                showNotification("Cita guardada correctamente", "success");
            } else {
                showNotification("Por favor, complete todos los campos", "error");
            }
        });

        // Add user button
        document.getElementById("addUserBtn").addEventListener("click", function() {
            document.getElementById('registerModal').classList.add('active');
        });

        // Close modal when clicking outside
        window.addEventListener("click", function (event) {
            if (event.target === document.getElementById('registerModal')) {
                document.getElementById('registerModal').classList.remove("active");
            }
        });

        // Refresh dashboard
        document.getElementById("refreshDashboard").addEventListener("click", function () {
            updateDashboardStats();
            showNotification("Dashboard actualizado", "success");
        });

        // Initialize with dashboard active
        showPage("dashboard");
    </script>
</body>
</html>